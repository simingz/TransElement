---
title: "Estimate the proportion of true null"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ashr)
```

### DEseq2 results
```{r  echo=TRUE}
deseq2 <- read.table("../data/for_ashr.txt", header=T)
dim(deseq2)
```
```{r  echo=TRUE}
head(deseq2)
```


### apply ashr
```{r  echo=TRUE}
betahat <- deseq2$log2FoldChange
sebetahat <- deseq2$lfcSE
#deseq2.fit <- ashr::ash(betahat, sebetahat, mixcompdist = "normal", outputlevel=2)
#save(deseq2.fit, file="deseq2.fit.normal.RDS")
deseq2.fit <-readRDS("deseq2.fit.normal.RDS") # the above step may take long without REBayes
```

### probability of |log2 fold change| < t
```{r  echo=TRUE}
t<-seq(0,3,0.02)
prop <- ashr::cdf.ash(deseq2.fit, t)$y - ashr::cdf.ash(deseq2.fit, -t)$y
plot(t,prop, main= "proportion of regions with |log2Fold change| < t", xlab= "log2Fold change", ylab="proportion", yaxt="n", pch = 16, col="salmon", ylim=c(0,1))
axis(2, at=pretty(runif(10)), lab=paste0(pretty(runif(10)) * 100, " %"), las=TRUE)
grid()
```

### Diagnostic plot for ASH
```{r echo=TRUE}
plot_diagnostic(deseq2.fit)
```
